jQuery.fn.popup=function(e){var c=this;init=function(d){d=$.extend({},{animDuration:300,backgroundCloses:!0,backgroundColor:"#000",backgroundOpacity:0.5,closeButton:!1,height:"auto",modal:!0,onOpen:void 0,onOpenEnd:void 0,onClose:void 0,onCloseEnd:void 0,openImmediately:!1,popupBackground:"#fff",popupBorder:"1px solid #333",prefix:"popup-",width:"33%",widthMin:200,widthMax:void 0,zIndex:1E4},d);c.data("popup")&&k();d.isOpen=!1;c.data("popup",d).hide();d.openImmediately&&l();return c};var k=function(){var d=
c.data("popup");return"object"!=typeof d?c:d.isOpen?(d.animDuration=0,d.onCloseEnd=function(){c.popup("destroy")},c.data("popup",d).popup("close")):c.unbind(".popup").data("popup",void 0).show()},l=function(){var d,b,e,f=$(window);scrollPos=Math.max($("body").scrollTop(),$("html").scrollTop(),$(window).scrollTop());if(!c.data("popup"))return init({openImmediately:!0});var a=c.data("popup");if(a.isOpen||"function"==typeof a.onOpen&&!1===a.onOpen())return c;var j=$("<div>");j.attr("class",c.attr("class")).data("popup",
{placeholderFor:c});c.replaceWith(j);var g=$("<div>").addClass(a.prefix+"container").hide(),h=$("<div>");h.addClass(a.prefix+"element").append(c).appendTo(g);d=a.height;b=a.width;e=(f.height()-d)/2+scrollPos;"string"==typeof b&&"%"==b.charAt(b.length-1)&&(b=f.width()*parseInt(b,10)/100);parseInt(d)!=d&&(d="auto",e=(f.height()-h.outerHeight())/3+scrollPos);e<scrollPos&&(e=scrollPos);"number"==typeof a.widthMin&&b<a.widthMin&&(b=a.widthMin);"number"==typeof a.widthMax&&b>a.widthMax&&(b=a.widthMax);
h.css({"background-color":a.popupBackground,border:a.popupBorder,left:"50%",height:d,"margin-left":-b/2,position:"absolute",top:e,width:b,"z-index":a.zIndex});c.show();a.closeButton&&$("<span>&times;</span>").addClass("close").css({cursor:"pointer",position:"absolute",right:5,top:0}).bind("click.popup",function(){c.popup("close")}).appendTo(h);a.modal&&(d=$("<div>"),d.addClass(a.prefix+"background").css({"background-color":a.backgroundColor,bottom:0,left:0,opacity:a.backgroundOpacity,position:"fixed",
right:0,top:0,"z-index":a.zIndex-1}).appendTo(g),a.backgroundCloses&&d.css("cursor","pointer").bind("click.popup",function(){c.popup("close")}));a.isOpen=!0;a.placeholder=j;a.container=g;c.data("popup",a);g.appendTo("body").fadeIn(a.animDuration,function(){if("fucntion"==typeof a.onOpenEnd)a.onOpenEnd()});return c},f=c.data("popup");if(f&&"placeholderFor"in f)return f.placeholderFor.popup(e);if("object"==typeof e||"undefined"==typeof e)init(e);else if("string"==typeof e){if("close"==e){var b=c.data("popup");
!b||!b.isOpen||"function"==typeof b.onClose&&!1===b.onClose()||b.container.fadeOut(b.animDuration,function(){b.placeholder.replaceWith(c.hide());b.container.remove();b.isOpen=!1;b.placeholder=void 0;b.container=void 0;c.data("popup",b);if("function"==typeof b.onCloseEnd)b.onCloseEnd()});return c}if("destroy"==e)return k();if("init"==e)return init();if("open"==e)return l()}return c};
